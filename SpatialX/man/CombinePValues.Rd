% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utilties.R
\name{CombinePValues}
\alias{CombinePValues}
\title{Combine multiple p-values using Cauchy combination rule}
\usage{
CombinePValues(pvalues, weights = NULL)
}
\arguments{
\item{pvalues}{A matrix of p-values where rows represent features (e.g., genes)
and columns represent different tests or kernels. Typically a
p x k matrix where k is the number of kernels (e.g., 10).}

\item{weights}{An optional matrix of weights with the same dimensions as
\code{pvalues}. If NULL, equal weights are used for all tests.
Weights should be non-negative and will be normalized for each
feature (row-wise normalization).}
}
\value{
A numeric vector of combined p-values, one for each row (feature)
        in the input matrix. The vector has the same length as the number
        of rows in \code{pvalues}.
}
\description{
This function combines p-values from multiple tests or kernels using the
Cauchy Combination Test (also known as ACAT). It is designed to efficiently
handle matrix inputs where each row represents a feature (e.g., gene) and
each column represents a different test or kernel.
}
\details{
The Cauchy Combination Test (ACAT) is a powerful method for combining
dependent p-values from multiple tests. This implementation is optimized
for the common use case in spatial transcriptomics where multiple spatial
kernels are tested for each gene.

For each feature (row), the function:
\enumerate{
  \item Normalizes weights to sum to 1 for that feature
  \item Applies the Cauchy transformation: \eqn{w_i \cdot \tan((0.5 - p_i) \cdot \pi)}
  \item Sums the transformed values across tests/kernels
  \item Converts back to a p-value using the Cauchy CDF
}

Key advantages of this method:
\itemize{
  \item Robust to dependencies between tests
  \item Powerful under sparse alternatives
  \item Computationally efficient for large matrices
  \item Handles both weighted and unweighted combination
}

The function automatically handles edge cases:
\itemize{
  \item If any p-value in a row is 0, the combined p-value is 0
  \item P-values of 1 are adjusted to avoid numerical issues
  \item NA values are removed with appropriate warnings
  \item Invalid p-values (<0 or >1) trigger errors
}
}
\examples{
\dontrun{
# Example with 100 genes and 10 kernels
pvals_matrix <- matrix(runif(1000), nrow = 100, ncol = 10)

# Combine with equal weights
combined_equal <- CombinePValues(pvals_matrix)

# Create custom weights (e.g., based on kernel importance)
weights_matrix <- matrix(rep(1:10, each = 100), nrow = 100, ncol = 10)
combined_weighted <- CombinePValues(pvals_matrix, weights_matrix)

# Use in spatial transcriptomics analysis
spatial_pvals <- GetSpatialPValues(spatial_object, kernels = 10)
significant_genes <- CombinePValues(spatial_pvals)

# Identify significant genes at FDR 0.05
fdr_adjusted <- p.adjust(significant_genes, method = "fdr")
sig_genes <- which(fdr_adjusted < 0.05)
}

}
\references{
Liu Y., et al. (2019). ACAT: A Fast and Powerful p Value Combination
Method for Rare-Variant Analysis in Sequencing Studies.
The American Journal of Human Genetics, 104(3), 410-421.
}
\seealso{
\code{\link{ComputeACAT}}, \code{\link[stats]{p.adjust}}
}
